# Day 2 - Understanding "sky130_fd_sc_hd_tt_025C_1v80"

### Introduction to timing .libs
- ```.lib``` files are the standard format for representing cell libraries.
- typical lib, can be slow, typical, fast
- 1v80: voltage
- 025C: temperature
- P V T: TOGETHER DETERMINES HOW THE SILICONE IS GOING TO WORK, ACROSS ALL CORNERS
	- P:PROCESS=>VARIATIONS DUE TO FABRICATION, DUE TO THE MACHINE IN USE
	- V:VOLTAGE
	- T:TEMPERATURE
- techonology: cmos
- delay model: table_lookup
- time: 1ns

> cell defines the beginning of the cell. Other information of cells mentioned are:
- Leakage power based on the combination of inputs
- Area
- Power ports
- Input capacitance
- Power associated with the pin
- Transition

### Find the Library:
```
find ~/.ciel -name "sky130_fd_sc_hd__tt_025C_1v80.lib"
```

- path: /home/ank/.ciel/ciel/sky130/versions/a80ed405766c5d4f21c8bfca84552a7478fe75b2/sky130A/libs.ref/sky130_fd_sc_hd/lib/
- liberty has the definition of and information on power, delay, area, timing associated with the pins of cells.

### Differnce between: and2_0 & and2_2:
- area: increases
- thus as the *_no. increases: area increases->larger cells employ wider transisters->faster->power also more->delay reduces

### Hierarchical vs Flat Synthesis
- file used: multiple_modules.v
##### STEPS:
```
yosys
read_liberty -lib /home/ank/.ciel/ciel/sky130/versions/a80ed405766c5d4f21c8bfca84552a7478fe75b2/sky130A/libs.ref/sky130_fd_sc_hd/lib/sky130_fd_sc_hd__tt_025C_1v80.lib
read_verilog multiple_modules.v
synth -top multiple_modules
abc -liberty /home/ank/.ciel/ciel/sky130/versions/a80ed405766c5d4f21c8bfca84552a7478fe75b2/sky130A/libs.ref/sky130_fd_sc_hd/lib/sky130_fd_sc_hd__tt_025C_1v80.lib
-> 'flatten' 
show <specify the module name> (will show instantiation: hierarchal: the hierarchy is preserved)
write_verilog <your_generated_netlist_filename_hier.v>
#if don't want attr:
write_verilog -noattr <your_generated_netlist_filename_hier.v>
```

## Why does the tool choose an input inverted NAND implementation for OR?

CMOS always realise inverted funtions.
NOR + INV -> OR: will have a stacked PMOS: BAD, avoid. -> stacked NMOS: preferred -> cause Stacked PMOS has poor mobility. Also for good logical effort.

```
flatten
write_verilog <-noattr> <your_generated_netlist_filename_flat.v>
show <specify modulename>
```

## Synthesize at submodule level in a multiple module file:

### Why is the sub-module level synthesis necessary?
- synthesize once, replicate multiple time and stitch together
- have multiple instances of same module
- massive design => DIVIDE AND CONQUER APPROACH
- Optimization and Area Reduction: By synthesizing sub-modules separately, the synthesis tool can optimize each one individually. It performs logic optimization, technology mapping, and area minimization for each sub-module. This leads to more efficient use of resources and reduced overall chip area.
- Resuability: Each submodule can be designed, verified, and optimized independently. They can be reused in a large design multiple times saving time and enhancing efficiency. 
- Parallel Processing: Different sub-modules can be synthesized concurrently, improving efficiency. For large designs, parallel synthesis significantly reduces turnaround time.

```
yosys
read_liberty -lib /home/ank/.ciel/ciel/sky130/versions/a80ed405766c5d4f21c8bfca84552a7478fe75b2/sky130A/libs.ref/sky130_fd_sc_hd/lib/sky130_fd_sc_hd__tt_025C_1v80.lib
read_verilog multiple_modules.v
synth -top <sub_module_name>
abc -liberty /home/ank/.ciel/ciel/sky130/versions/a80ed405766c5d4f21c8bfca84552a7478fe75b2/sky130A/libs.ref/sky130_fd_sc_hd/lib/sky130_fd_sc_hd__tt_025C_1v80.lib
show
```

## How to design a FLOP & different flop coding styles:

### Why Flops?
-output glitches due to prp delay.
-more combinatinal ckt means more glitches.
-thus we use Flops (DFF) between combinational ckts.
-Flop output is stable

Glitches can occur in digital circuits due to various reasons such as signal delays, noise, or timing issues. Flops prevent glitches during the operation in the following ways:
- Synchronization: Flops are edge-triggered devices, meaning they respond only to transitions of the input signal (e.g., rising edge, falling edge). This synchronization ensures that the output changes only at specific points, reducing the likelihood of glitches caused by transient signal variations.
- Timing Control: Flops are typically controlled by a clock signal, ensuring that all circuit operations occur synchronously. This eliminates timing issues that could lead to glitches due to data arriving at different times.

Reset and Set: both can be Async or Sync.
### Design of sync and async reset and set, code and their pictorial representation.

> Simulated: 
	dff async set & reset
	dff sync set & reset
	dff_asyncreset_syncreset
```
iverilog <filename.v> <tb_filename.v>
./a.out
gtkwave <tb_filename.vcd>
gtkwave ./<tb_filename.vcd>
```

> Synthesis:
```
yosys
read_liberty -lib /home/ank/.ciel/ciel/sky130/versions/a80ed405766c5d4f21c8bfca84552a7478fe75b2/sky130A/libs.ref/sky130_fd_sc_hd/lib/sky130_fd_sc_hd__tt_025C_1v80.lib
read_verilog <filename.v>
synth -top <sub_module_name>
dfflibmap -liberty /home/ank/.ciel/ciel/sky130/versions/a80ed405766c5d4f21c8bfca84552a7478fe75b2/sky130A/libs.ref/sky130_fd_sc_hd/lib/sky130_fd_sc_hd__tt_025C_1v80.lib
abc -liberty /home/ank/.ciel/ciel/sky130/versions/a80ed405766c5d4f21c8bfca84552a7478fe75b2/sky130A/libs.ref/sky130_fd_sc_hd/lib/sky130_fd_sc_hd__tt_025C_1v80.lib
write_verilog <-noattr> <your_generated_netlist_filename_flat.v>
show
```

# Some Optimizations made by tool:
- defined active high set/reset macro in the liberty, tool uses inverter to provide and aling with low set/reset input in RTL code.
- multiply by 2^n => shift left by n (append 'n' number of zeros).
- multiply by 9 => 2x[2:0] mapped to [5:0].

